rule demoverse_workspace_MalwareDownload {
meta:
    author      = "Google Cloud Security"
    description = "Google detected a download of data that looks to be malware"
    severity    = "Medium"
	log_source  = "Google Workspace"

events:
    $event.additional.fields["trigger_type"] = "FILE_DOWNLOAD"
    $event.metadata.product_event_type = "MALWARE_TRANSFER"
    $event.security_result.action= "ALLOW"
    $event.metadata.vendor_name = "Google Workspace"
    $event.additional.fields["trigger_user"] = $user
    $event.additional.fields["content_hash"] = $hash
    $event.additional.fields["content_name"] = $local_file
    $event.additional.fields["content_size"] = $file_bytes

match:
    $user over 2m

outcome:
    $risk_score = max(75)
    $Username = array_distinct($user)
    $targetURL = array_distinct($event.target.url)
    $Machine_User_Login = array_distinct($event.target.user.user_display_name)
    $FileHash = array_distinct($hash)
    $File_Size_Bytes = array_distinct($file_bytes)

condition:
    $event
}
